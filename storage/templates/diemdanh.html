<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Äiá»ƒm danh sinh viÃªn</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #webcam-section { display: none; }
    #info-box {
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      background-color: #f8f9fa;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container mt-5">
    <div class="card shadow p-4">
      <h3 class="mb-4">ğŸ“¸ Äiá»ƒm danh sinh viÃªn</h3>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="alert alert-info">{{ messages[0] }}</div>
        {% endif %}
      {% endwith %}

      <!-- Form chá»n lá»›p vÃ  mÃ´n há»c -->
      <form method="POST" id="form-diemdanh">
        <div class="mb-3">
          <label class="form-label">Chá»n mÃ´n há»c:</label>
          <select name="monhoc" class="form-select" required>
            <option value="">-- Chá»n --</option>
            <option>Thá»‹ GiÃ¡c MÃ¡y TÃ­nh</option>
            <option>Há»‡ Thá»‘ng ThÃ´ng Tin Quáº£n LÃ½</option>
            <option>MÃ¡y Há»c á»¨ng Dá»¥ng</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Chá»n lá»›p (file Excel):</label>
          <select name="filelop" class="form-select" required>
            {% for file in excel_files %}
              <option value="{{ file }}">{{ file }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Chá»n buá»•i há»c:</label>
          <select name="buoihoc" class="form-select" required>
            <option value="">-- Chá»n --</option>
            <option value="SÃ¡ng">SÃ¡ng (07:00 - 10:30)</option>
            <option value="Chiá»u">Chiá»u (13:00 - 16:30)</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary">Báº¯t Ä‘áº§u Ä‘iá»ƒm danh</button>
      </form>

      <!-- Webcam + thÃ´ng tin sinh viÃªn Ä‘Æ°á»£c Ä‘iá»ƒm danh -->
      <div id="webcam-section" class="mt-4 text-center">
        <h5 class="mb-3">ğŸ¥ Webcam Ä‘ang hoáº¡t Ä‘á»™ng</h5>
        <img src="{{ url_for('video_feed') }}" width="480" class="border rounded shadow">
        
        <div class="mt-4 text-start">
          <h6>ğŸ§¾ Danh sÃ¡ch sinh viÃªn Ä‘Æ°á»£c Ä‘iá»ƒm danh:</h6>
          <div id="info-box">
            <!-- Báº¡n cÃ³ thá»ƒ cáº­p nháº­t báº±ng fetch('/api/log') táº¡i Ä‘Ã¢y -->
            <em>ThÃ´ng tin sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y...</em>
          </div>
        </div>

        <form method="GET" action="{{ url_for('home') }}">
          <button type="submit" class="btn btn-danger mt-4">ğŸ›‘ Káº¿t thÃºc Ä‘iá»ƒm danh</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("form-diemdanh");
    const webcamSection = document.getElementById("webcam-section");

    form.addEventListener("submit", function () {
      form.style.display = "none";
      webcamSection.style.display = "block";
    });
  </script>
</body>
</html>
